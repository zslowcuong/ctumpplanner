<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Tr√¨nh qu·∫£n l√Ω k·∫ø ho·∫°ch th√¥ng minh PRO</title>
  <style>
    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      margin: 0;
      padding: 0;
      background: #020617;
      color: #e5e7eb;
    }

    /* ===== THEME CTUMP (n·ªÅn s√°ng d·ªãu) ===== */
    body.theme-ctump {
      background: #f3f4f6;
      color: #111827;
    }

    body.theme-ctump .card {
      background: #ffffff;
      border-color: #e5e7eb;
      box-shadow: 0 8px 20px rgba(15, 23, 42, 0.08);
    }

    body.theme-ctump input[type="text"],
    body.theme-ctump textarea,
    body.theme-ctump select,
    body.theme-ctump input[type="date"],
    body.theme-ctump input[type="time"] {
      background: #f9fafb;
      border-color: #d1d5db;
      color: #111827;
    }

    body.theme-ctump input:focus,
    body.theme-ctump textarea:focus,
    body.theme-ctump select:focus {
      background: #ffffff;
    }

    body.theme-ctump .schedule-grid th {
      background: #e5e7eb;
      color: #111827;
    }

    body.theme-ctump .schedule-task {
      background: #f9fafb;
      border-color: #d1d5db;
    }

    body.theme-ctump .hero-overlay {
      background: linear-gradient(
          135deg,
          rgba(59, 130, 246, 0.25),
          rgba(239, 68, 68, 0.18)
        );
    }

    body.theme-ctump .hero-title {
      color: #111827;
    }

    body.theme-ctump .hero-subtitle {
      color: #374151;
    }

    .page {
      padding: 20px;
    }

    h1, h2, h3 {
      margin: 0 0 10px;
    }

    .app-container {
      max-width: 1200px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: 1.2fr 1.8fr;
      gap: 20px;
    }

    .card {
      background: #020617;
      border-radius: 16px;
      padding: 16px 20px;
      box-shadow: 0 10px 25px rgba(15, 23, 42, 0.7);
      border: 1px solid #1f2933;
    }

    .card + .card {
      margin-top: 12px;
    }

    label {
      font-size: 14px;
      display: block;
      margin-bottom: 4px;
      color: #9ca3af;
    }

    input[type="text"],
    textarea,
    select,
    input[type="date"],
    input[type="time"] {
      width: 100%;
      padding: 8px 10px;
      border-radius: 8px;
      border: 1px solid #374151;
      font-size: 14px;
      outline: none;
      transition: border-color 0.15s ease, box-shadow 0.15s ease;
      background: #020617;
      color: #e5e7eb;
    }

    input:focus,
    textarea:focus,
    select:focus {
      border-color: #3b82f6;
      box-shadow: 0 0 0 1px #1d4ed8;
      background: #020617;
    }

    textarea {
      resize: vertical;
      min-height: 60px;
    }

    .field-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }

    .field-row-3 {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 10px;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      padding: 8px 14px;
      border-radius: 999px;
      border: none;
      background: #2563eb;
      color: #ffffff;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      margin-top: 10px;
      transition: transform 0.08s ease, box-shadow 0.08s ease, background 0.08s ease;
      box-shadow: 0 8px 16px rgba(37, 99, 235, 0.45);
      text-decoration: none;
      white-space: nowrap;
    }

    .btn:hover {
      background: #1d4ed8;
      transform: translateY(-1px);
      box-shadow: 0 12px 22px rgba(37, 99, 235, 0.6);
    }

    .btn:active {
      transform: translateY(0);
      box-shadow: 0 4px 10px rgba(37, 99, 235, 0.4);
    }

    .btn-secondary {
      background: #0f172a;
      box-shadow: 0 8px 16px rgba(15, 23, 42, 0.6);
    }

    body.theme-ctump .btn-secondary {
      background: #e5e7eb;
      color: #111827;
      box-shadow: 0 4px 12px rgba(15, 23, 42, 0.12);
    }

    .btn-small {
      padding: 6px 10px;
      font-size: 12px;
      box-shadow: none;
      margin-top: 0;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.04em;
      margin-right: 6px;
      white-space: nowrap;
    }

    .badge-day {
      background: #1d4ed8;
      color: #e5e7eb;
    }

    .badge-week {
      background: #15803d;
      color: #e5e7eb;
    }

    .badge-month {
      background: #92400e;
      color: #fef9c3;
    }

    .badge-year {
      background: #b91c1c;
      color: #fee2e2;
    }

    .badge-priority-high {
      background: #b91c1c;
      color: #fee2e2;
    }

    .badge-priority-medium {
      background: #0369a1;
      color: #e0f2fe;
    }

    .badge-priority-low {
      background: #047857;
      color: #ecfdf5;
    }

    .task-list {
      max-height: 260px;
      overflow-y: auto;
      padding-right: 4px;
    }

    .task-item {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      padding: 8px 0;
      border-bottom: 1px dashed #1f2937;
      gap: 8px;
    }

    .task-main {
      display: flex;
      align-items: flex-start;
      gap: 8px;
      flex: 1;
    }

    .task-checkbox {
      margin-top: 2px;
    }

    .task-title {
      font-size: 14px;
      font-weight: 600;
      color: inherit;
    }

    .task-meta {
      font-size: 12px;
      color: #9ca3af;
      margin-top: 2px;
    }

    body.theme-ctump .task-meta {
      color: #6b7280;
    }

    .task-note {
      font-size: 12px;
      color: #cbd5f5;
      margin-top: 2px;
    }

    body.theme-ctump .task-note {
      color: #4b5563;
    }

    .task-suggestion {
      font-size: 12px;
      color: #67e8f9;
      margin-top: 2px;
      font-style: italic;
    }

    .task-actions {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .small-btn {
      border: none;
      background: transparent;
      color: #9ca3af;
      font-size: 11px;
      cursor: pointer;
      padding: 2px 4px;
      border-radius: 6px;
    }

    .small-btn:hover {
      background: #111827;
      color: #e5e7eb;
    }

    body.theme-ctump .small-btn:hover {
      background: #e5e7eb;
      color: #111827;
    }

    .completed .task-title {
      text-decoration: line-through;
      color: #6b7280;
    }

    .completed .task-note {
      opacity: 0.6;
    }

    .completed .task-meta {
      opacity: 0.6;
    }

    .pill-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 10px;
    }

    .hint {
      font-size: 12px;
      color: #9ca3af;
      margin-top: 4px;
    }

    body.theme-ctump .hint {
      color: #6b7280;
    }

    /* Schedule / Timetable */
    .schedule-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
      flex-wrap: wrap;
    }

    .schedule-actions {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
    }

    .schedule-grid {
      width: 100%;
      border-collapse: collapse;
      font-size: 12px;
    }

    .schedule-grid th,
    .schedule-grid td {
      border: 1px solid #1f2937;
      padding: 6px;
      vertical-align: top;
    }

    .schedule-grid th {
      background: #020617;
      text-align: center;
      font-weight: 600;
      position: sticky;
      top: 0;
      z-index: 1;
    }

    body.theme-ctump .schedule-grid th {
      background: #e5e7eb;
      color: #111827;
    }

    .schedule-task {
      background: #0b1120;
      border-radius: 10px;
      padding: 4px 6px;
      margin-bottom: 4px;
      word-wrap: break-word;
      border: 1px solid #1d4ed8;
    }

    .schedule-task span {
      display: block;
    }

    .schedule-task-title {
      font-weight: 600;
      font-size: 11px;
      color: #bfdbfe;
    }

    body.theme-ctump .schedule-task-title {
      color: #1d4ed8;
    }

    .schedule-task-note {
      font-size: 11px;
      color: #e5e7eb;
    }

    body.theme-ctump .schedule-task-note {
      color: #374151;
    }

    .schedule-task-extra {
      font-size: 11px;
      color: #67e8f9;
      font-style: italic;
    }

    .tips {
      margin-top: 10px;
      padding: 8px 10px;
      background: #0f172a;
      border-radius: 12px;
      border-left: 3px solid #0ea5e9;
      font-size: 12px;
      color: #e5e7eb;
    }

    body.theme-ctump .tips {
      background: #e5f3ff;
      color: #1f2937;
      border-left-color: #0ea5e9;
    }

    .tips ul {
      padding-left: 16px;
      margin: 4px 0 0;
    }

    .tips li {
      margin-bottom: 2px;
    }

    @media (max-width: 900px) {
      .app-container {
        grid-template-columns: 1fr;
      }
    }

    /* HERO v·ªõi ·∫£nh kh√¥ng gian / CTUMP */
    .hero {
      position: relative;
      width: 100%;
      max-width: 1200px;
      margin: 0 auto 20px;
      height: 220px;
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 20px 40px rgba(15,23,42,0.9);
      border: 1px solid #1f2937;
    }

    .hero-bg {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
      transform: scale(1.03);
    }

    .hero-overlay {
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at 20% 20%, rgba(56,189,248,0.4), transparent 55%),
                  radial-gradient(circle at 80% 80%, rgba(248,113,113,0.3), transparent 55%),
                  rgba(15,23,42,0.65);
    }

    .hero-content {
      position: absolute;
      inset: 0;
      padding: 18px 22px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      color: #e5e7eb;
    }

    .hero-title {
      font-size: 24px;
      font-weight: 700;
    }

    .hero-subtitle {
      font-size: 13px;
      color: #d1d5db;
      max-width: 420px;
    }

    .hero-pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 11px;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.6);
      background: rgba(15,23,42,0.6);
      backdrop-filter: blur(6px);
    }

    body.theme-ctump .hero-pill {
      background: rgba(255,255,255,0.7);
      border-color: rgba(148,163,184,0.7);
      color: #111827;
    }

    .hero-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 11px;
      color: #cbd5f5;
      gap: 10px;
      flex-wrap: wrap;
    }

    body.theme-ctump .hero-footer {
      color: #4b5563;
    }

    /* ƒê·ªÅ m·ª•c th∆∞·ªùng d√πng */
    .chip-list {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 6px;
    }

    .chip {
      display: inline-flex;
      align-items: center;
      background: #020617;
      border-radius: 999px;
      border: 1px solid #334155;
      padding: 4px 10px;
      font-size: 12px;
      color: #e5e7eb;
      cursor: pointer;
      gap: 6px;
    }

    body.theme-ctump .chip {
      background: #f9fafb;
      border-color: #d1d5db;
      color: #111827;
    }

    .chip:hover {
      background: #111827;
    }

    body.theme-ctump .chip:hover {
      background: #e5e7eb;
    }

    .chip-remove {
      font-size: 11px;
      color: #9ca3af;
      cursor: pointer;
    }

    .chip-remove:hover {
      color: #fca5a5;
    }

    /* L·ªãch t∆∞∆°ng t√°c */
    .calendar {
      margin-top: 8px;
    }

    .calendar-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 8px;
    }

    .calendar-nav-btn {
      border: 1px solid #374151;
      background: #020617;
      color: #e5e7eb;
      border-radius: 999px;
      width: 28px;
      height: 28px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 16px;
    }

    body.theme-ctump .calendar-nav-btn {
      background: #ffffff;
      color: #111827;
      border-color: #d1d5db;
    }

    .calendar-nav-btn:hover {
      background: #111827;
    }

    body.theme-ctump .calendar-nav-btn:hover {
      background: #e5e7eb;
    }

    .calendar-month-label {
      font-weight: 600;
      font-size: 14px;
    }

    .calendar-weekdays,
    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      font-size: 11px;
      text-align: center;
    }

    .calendar-weekdays div {
      padding: 4px 0;
      color: #9ca3af;
    }

    body.theme-ctump .calendar-weekdays div {
      color: #6b7280;
    }

    .calendar-day {
      padding: 6px 0;
      margin: 2px;
      border-radius: 8px;
      cursor: pointer;
    }

    .calendar-day--today {
      border: 1px solid #3b82f6;
      background: #0b1120;
      font-weight: 600;
      color: #bfdbfe;
    }

    body.theme-ctump .calendar-day--today {
      background: #e0f2fe;
      color: #1d4ed8;
    }

    .calendar-day--other-month {
      opacity: 0.4;
    }

    .calendar-day--selected {
      border: 1px solid #f97316;
      background: #111827;
    }

    body.theme-ctump .calendar-day--selected {
      background: #ffedd5;
      border-color: #f97316;
    }

    /* Khung k·∫ø ho·∫°ch c·ªßa ng√†y ƒë√£ ch·ªçn */
    .selected-day-box {
      margin-top: 10px;
      padding: 8px 10px;
      background: #020617;
      border-radius: 12px;
      border: 1px solid #1f2937;
      font-size: 12px;
    }

    body.theme-ctump .selected-day-box {
      background: #ffffff;
      border-color: #e5e7eb;
    }

    .selected-day-title {
      font-weight: 600;
      margin-bottom: 4px;
    }

    .selected-day-title span {
      color: #bfdbfe;
    }

    body.theme-ctump .selected-day-title span {
      color: #1d4ed8;
    }

    .selected-day-task {
      padding: 4px 0;
      border-bottom: 1px dashed #1f2937;
    }

    body.theme-ctump .selected-day-task {
      border-color: #e5e7eb;
    }

    .selected-day-task:last-child {
      border-bottom: none;
    }

    .selected-day-task-title {
      font-size: 13px;
      font-weight: 600;
    }

    .selected-day-task-note {
      font-size: 12px;
      color: #cbd5f5;
    }

    body.theme-ctump .selected-day-task-note {
      color: #4b5563;
    }

    .selected-day-task-meta {
      font-size: 11px;
      color: #9ca3af;
    }

    body.theme-ctump .selected-day-task-meta {
      color: #6b7280;
    }

    .selected-filter-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
      margin: 8px 0;
      font-size: 12px;
    }

    .selected-filter-row select {
      width: auto;
      min-width: 130px;
      padding: 4px 8px;
      font-size: 12px;
    }

    /* Th∆∞ vi·ªán m√¥n h·ªçc & b√†i h·ªçc */
    .lesson-item {
      border-bottom: 1px dashed #1f2937;
      padding: 6px 0;
      font-size: 12px;
    }

    body.theme-ctump .lesson-item {
      border-color: #e5e7eb;
    }

    .lesson-item:last-child {
      border-bottom: none;
    }

    .lesson-title {
      font-size: 13px;
      font-weight: 600;
    }

    .lesson-meta {
      color: #9ca3af;
      margin-top: 2px;
    }

    body.theme-ctump .lesson-meta {
      color: #6b7280;
    }

    .lesson-links {
      margin-top: 2px;
      color: #bfdbfe;
      word-break: break-all;
    }

    body.theme-ctump .lesson-links {
      color: #1d4ed8;
    }

    .lesson-files {
      margin-top: 2px;
    }

    .lesson-file-link {
      display: inline-block;
      font-size: 11px;
      padding: 2px 6px;
      border-radius: 999px;
      border: 1px solid #1d4ed8;
      margin-right: 4px;
      margin-bottom: 2px;
      text-decoration: none;
      color: #bfdbfe;
    }

    body.theme-ctump .lesson-file-link {
      color: #1d4ed8;
      border-color: #1d4ed8;
    }

    .lesson-thumb {
      max-width: 80px;
      max-height: 60px;
      display: block;
      margin-top: 4px;
      border-radius: 8px;
      border: 1px solid #1f2937;
    }

    body.theme-ctump .lesson-thumb {
      border-color: #e5e7eb;
    }

    /* Watermark b·∫£n quy·ªÅn */
    .watermark {
      position: fixed;
      right: 10px;
      bottom: 10px;
      font-size: 12px;
      letter-spacing: 0.12em;
      color: #4b5563;
      opacity: 0.8;
      pointer-events: none;
      user-select: none;
      font-weight: 600;
    }
  </style>
</head>
<body>
  <!-- WATERMARK -->
  <div class="watermark">ZSLOWC - TRAN CHI CUONG</div>

  <!-- HERO v·ªõi ·∫£nh kh√¥ng gian / CTUMP -->
  <div class="hero">
    <img src="space-bg.jpg" alt="Background" class="hero-bg" />
    <div class="hero-overlay"></div>
    <div class="hero-content">
      <div>
        <div class="hero-pill">
          üöÄ Planner kh√¥ng gian ¬∑ Qu·∫£n l√Ω th·ªùi gian nh∆∞ phi h√†nh gia
        </div>
        <div style="height:10px;"></div>
        <div class="hero-title">Tr√¨nh qu·∫£n l√Ω k·∫ø ho·∫°ch th√¥ng minh PRO</div>
        <div class="hero-subtitle">
          L·∫≠p k·∫ø ho·∫°ch ng√†y / tu·∫ßn / th√°ng / nƒÉm, l∆∞u t·ª± ƒë·ªông, g·ª£i √Ω khung gi·ªù,
          v√† ch·ªâ m·ªôt c√∫ click ƒë·ªÉ ch√®n m√¥n h·ªçc hay ƒë·ªÅ m·ª•c l·∫∑p l·∫°i.
        </div>
      </div>
      <div class="hero-footer">
        <span>üìÖ Th·ªùi kh√≥a bi·ªÉu tu·∫ßn ¬∑ ‚è±Ô∏è T·ªëi ∆∞u th·ªùi gian</span>
        <span>‚ú® ·∫¢nh n·ªÅn: h√†nh tinh kh√¥ng gian / CTUMP</span>
        <button class="btn btn-small btn-secondary" id="toggle-theme-btn">
          Giao di·ªán: Space
        </button>
      </div>
    </div>
  </div>

  <div class="page">
    <div class="app-container">
      <!-- LEFT: INPUT FORM + ƒê·ªÄ M·ª§C TH∆Ø·ªúNG D√ôNG + TH∆Ø VI·ªÜN M√îN H·ªåC -->
      <div>
        <div class="card">
          <h2>‚ûï Th√™m k·∫ø ho·∫°ch m·ªõi</h2>
          <div class="pill-row">
            <div class="badge badge-day">Trong ng√†y</div>
            <div class="badge badge-week">Trong tu·∫ßn</div>
            <div class="badge badge-month">Trong th√°ng</div>
            <div class="badge badge-year">Trong nƒÉm</div>
          </div>

          <label for="task-title">Ti√™u ƒë·ªÅ k·∫ø ho·∫°ch</label>
          <input id="task-title" type="text" placeholder="V√≠ d·ª•: H·ªçc To√°n, L√Ω, VƒÉn; Vi·∫øt b√°o c√°o; T·∫≠p gym..." />

          <label for="task-note">Ghi ch√∫ th√™m (t√πy ch·ªçn)</label>
          <textarea id="task-note" placeholder="V√≠ d·ª•: ∆Øu ti√™n bu·ªïi s√°ng, c·∫ßn t·∫≠p trung cao, ƒë·ªãa ƒëi·ªÉm, ng∆∞·ªùi li√™n quan..."></textarea>

          <div class="field-row-3">
            <div>
              <label for="task-level">M·ª©c k·∫ø ho·∫°ch</label>
              <select id="task-level">
                <option value="day">K·∫ø ho·∫°ch trong ng√†y</option>
                <option value="week">K·∫ø ho·∫°ch trong tu·∫ßn</option>
                <option value="month">K·∫ø ho·∫°ch trong th√°ng</option>
                <option value="year">K·∫ø ho·∫°ch trong nƒÉm</option>
              </select>
            </div>
            <div id="day-date-wrapper">
              <label for="task-date">Ng√†y</label>
              <input id="task-date" type="date" />
            </div>
            <div id="day-time-wrapper">
              <label for="task-time">Gi·ªù b·∫Øt ƒë·∫ßu (k·∫ø ho·∫°ch trong ng√†y)</label>
              <input id="task-time" type="time" />
            </div>
          </div>

          <div class="field-row" style="margin-top:8px;">
            <div id="day-end-time-wrapper">
              <label for="task-end-time">Gi·ªù k·∫øt th√∫c (k·∫ø ho·∫°ch trong ng√†y)</label>
              <input id="task-end-time" type="time" />
            </div>
            <div>
              <label for="task-priority">M·ª©c ∆∞u ti√™n</label>
              <select id="task-priority">
                <option value="high">Cao (quan tr·ªçng & kh·∫©n c·∫•p)</option>
                <option value="medium" selected>Trung b√¨nh</option>
                <option value="low">Th·∫•p (vi·ªác nh·∫π / linh ho·∫°t)</option>
              </select>
            </div>
          </div>

          <div class="hint">
            ‚Ä¢ V·ªõi <strong>k·∫ø ho·∫°ch trong ng√†y</strong> n√™n ch·ªçn c·∫£ ng√†y v√† gi·ªù b·∫Øt ƒë·∫ßu / k·∫øt th√∫c c·ª• th·ªÉ.<br />
            ‚Ä¢ V·ªõi <strong>k·∫ø ho·∫°ch trong tu·∫ßn / th√°ng / nƒÉm</strong> c√≥ th·ªÉ b·ªè tr·ªëng ng√†y,
            coi nh∆∞ vi·ªác c·∫ßn l√†m trong giai ƒëo·∫°n ƒë√≥.<br />
            ‚Ä¢ ∆Øu ti√™n <strong>Cao</strong> ‚Üí bu·ªïi s√°ng, <strong>Trung b√¨nh</strong> ‚Üí bu·ªïi chi·ªÅu,
            <strong>Th·∫•p</strong> ‚Üí bu·ªïi t·ªëi.
          </div>

          <button class="btn" id="add-task-btn">Th√™m k·∫ø ho·∫°ch</button>
        </div>

        <!-- ƒê·ªÅ m·ª•c th∆∞·ªùng d√πng -->
        <div class="card">
          <h2>üìö ƒê·ªÅ m·ª•c th∆∞·ªùng d√πng (m√¥n h·ªçc / ho·∫°t ƒë·ªông)</h2>
          <label for="frequent-input">Th√™m ƒë·ªÅ m·ª•c m·ªõi</label>
          <div class="field-row">
            <input id="frequent-input" type="text" placeholder="V√≠ d·ª•: To√°n, V·∫≠t l√Ω, Ti·∫øng Anh, Luy·ªán piano..." />
            <button class="btn btn-secondary" id="add-frequent-btn">Th√™m v√†o danh s√°ch</button>
          </div>
          <div class="hint">
            üëâ B·∫•m m·ªôt <strong>chip</strong> b√™n d∆∞·ªõi ƒë·ªÉ ch√®n v√†o <strong>Ti√™u ƒë·ªÅ k·∫ø ho·∫°ch</strong>.<br/>
            B·∫•m d·∫•u <strong>x</strong> ƒë·ªÉ x√≥a. Danh s√°ch ƒë∆∞·ª£c l∆∞u l·∫°i (local + cloud).
          </div>
          <div id="frequent-list" class="chip-list"></div>
        </div>

        <!-- TH∆Ø VI·ªÜN M√îN H·ªåC & B√ÄI H·ªåC -->
        <div class="card">
          <h2>üìñ Th∆∞ vi·ªán m√¥n h·ªçc & b√†i h·ªçc</h2>
          <div class="hint">
            Danh s√°ch m√¥n h·ªçc l·∫•y t·ª´ <strong>ƒê·ªÅ m·ª•c th∆∞·ªùng d√πng</strong>.  
            M·ªói m√¥n c√≥ th·ªÉ th√™m nhi·ªÅu b√†i h·ªçc, ch∆∞∆°ng, link v√† ƒë√≠nh k√®m file/·∫£nh.
          </div>

          <label for="subject-select">Ch·ªçn m√¥n h·ªçc</label>
          <select id="subject-select"></select>

          <label for="lesson-search" style="margin-top:8px;">T√¨m ki·∫øm b√†i h·ªçc</label>
          <input id="lesson-search" type="text" placeholder="Nh·∫≠p t√™n b√†i, ch∆∞∆°ng ho·∫∑c t·ª´ kh√≥a..." />
          <div class="hint">
            L·ªçc theo <strong>t√™n b√†i</strong>, <strong>ch∆∞∆°ng</strong>, <strong>link/ghi ch√∫</strong>.
          </div>

          <div class="field-row" style="margin-top:8px;">
            <div>
              <label for="lesson-title">T√™n b√†i h·ªçc</label>
              <input id="lesson-title" type="text" placeholder="V√≠ d·ª•: ƒê·ªãnh lu·∫≠t Newton, √în t·∫≠p ch∆∞∆°ng 1..." />
            </div>
            <div>
              <label for="lesson-chapter">Ch∆∞∆°ng / Ch·ªß ƒë·ªÅ</label>
              <input id="lesson-chapter" type="text" placeholder="V√≠ d·ª•: Ch∆∞∆°ng 1, Ch∆∞∆°ng 3 - C∆° h·ªçc..." />
            </div>
          </div>

          <label for="lesson-link" style="margin-top:8px;">Link t√†i li·ªáu / ghi ch√∫ th√™m</label>
          <textarea id="lesson-link" placeholder="D√°n link Drive, video, PDF, ho·∫∑c ghi ch√∫ ng·∫Øn..."></textarea>

          <label for="lesson-file" style="margin-top:8px;">ƒê√≠nh k√®m ·∫£nh / file (t√πy ch·ªçn)</label>
          <input id="lesson-file" type="file" multiple />

          <button class="btn btn-secondary" id="add-lesson-btn">Th√™m b√†i h·ªçc cho m√¥n n√†y</button>

          <div class="hint">
            ‚Ä¢ File n·∫∑ng n√™n l∆∞u tr√™n Drive r·ªìi d√°n link ·ªü √¥ tr√™n.  
            ‚Ä¢ D·ªØ li·ªáu b√†i h·ªçc c≈©ng ƒë∆∞·ª£c l∆∞u LocalStorage + Firebase.
          </div>

          <div id="lesson-list" style="margin-top:10px; max-height:220px; overflow:auto;"></div>
        </div>

        <div class="card">
          <h2>üìã Danh s√°ch k·∫ø ho·∫°ch</h2>
          <div class="task-list" id="task-list"></div>
          <div class="hint">
            ‚úÖ Check v√†o k·∫ø ho·∫°ch trong ng√†y ƒë·ªÉ ƒë√°nh d·∫•u ho√†n th√†nh.<br />
            üßä D·ªØ li·ªáu l∆∞u t·ª± ƒë·ªông: LocalStorage + Firebase.<br />
            üóëÔ∏è C√≥ th·ªÉ xo√° t·ª´ng k·∫ø ho·∫°ch n·∫øu kh√¥ng c√≤n ph√π h·ª£p.
          </div>
        </div>
      </div>

      <!-- RIGHT: SCHEDULE & CALENDAR -->
      <div>
        <div class="card">
          <div class="schedule-header">
            <div>
              <h2>üß† Th·ªùi kh√≥a bi·ªÉu tu·∫ßn th√¥ng minh</h2>
              <p class="hint">
                T·ª± l·∫•y <strong>k·∫ø ho·∫°ch trong tu·∫ßn</strong> v√† ph√¢n ph·ªëi ƒë·ªÅu v√†o 7 ng√†y, k√®m g·ª£i √Ω khung gi·ªù.
              </p>
            </div>
            <div class="schedule-actions">
              <button class="btn btn-secondary btn-small" id="generate-schedule-btn">
                T·∫°o th·ªùi kh√≥a bi·ªÉu
              </button>
              <button class="btn btn-small" id="export-pdf-btn">
                Xu·∫•t PDF
              </button>
              <button class="btn btn-small" id="export-excel-btn">
                Xu·∫•t Excel
              </button>
              <a class="btn btn-small"
                 href="https://sinhvien.ctump.edu.vn/lich-hoc-lich-thi-theo-tuan.html"
                 target="_blank"
                 rel="noopener noreferrer">
                Th·ªùi kh√≥a bi·ªÉu CTUMP
              </a>
            </div>
          </div>

          <div style="max-height:280px; overflow:auto; border-radius:12px;">
            <table class="schedule-grid" id="schedule-table"></table>
          </div>

          <div class="tips" id="tips-box" style="display:none;">
            <strong>üí° G·ª£i √Ω qu·∫£n l√Ω th·ªùi gian:</strong>
            <ul id="tips-list"></ul>
          </div>
        </div>

        <!-- L·ªäCH TH√ÅNG T∆Ø∆†NG T√ÅC + K·∫æ HO·∫†CH NG√ÄY -->
        <div class="card">
          <h2>üìÖ L·ªãch th√°ng (xem & ch·ªçn ng√†y)</h2>
          <p class="hint">
            B·∫•m v√†o m·ªôt ng√†y tr√™n l·ªãch ƒë·ªÉ xem nhanh c√°c k·∫ø ho·∫°ch ƒë√£ ƒë·∫∑t cho ng√†y ƒë√≥ (c√≥ th·ªÉ l·ªçc theo lo·∫°i & m·ª©c ∆∞u ti√™n).
          </p>
          <div class="calendar">
            <div class="calendar-header">
              <button class="calendar-nav-btn" id="cal-prev">‚Äπ</button>
              <div class="calendar-month-label" id="calendar-month-label">Th√°ng ...</div>
              <button class="calendar-nav-btn" id="cal-next">‚Ä∫</button>
            </div>
            <div class="calendar-weekdays">
              <div>T2</div>
              <div>T3</div>
              <div>T4</div>
              <div>T5</div>
              <div>T6</div>
              <div>T7</div>
              <div>CN</div>
            </div>
            <div class="calendar-grid" id="calendar-grid"></div>
          </div>

          <div class="selected-day-box">
            <div class="selected-day-title" id="selected-day-title">
              Ch·ªçn m·ªôt ng√†y tr√™n l·ªãch ƒë·ªÉ xem k·∫ø ho·∫°ch.
            </div>

            <div class="selected-filter-row">
              <span>B·ªô l·ªçc:</span>
              <select id="filter-level">
                <option value="all">T·∫•t c·∫£ lo·∫°i k·∫ø ho·∫°ch</option>
                <option value="day">Ch·ªâ k·∫ø ho·∫°ch trong ng√†y</option>
                <option value="week">Trong tu·∫ßn</option>
                <option value="month">Trong th√°ng</option>
                <option value="year">Trong nƒÉm</option>
              </select>
              <select id="filter-priority">
                <option value="all">T·∫•t c·∫£ m·ª©c ∆∞u ti√™n</option>
                <option value="high">∆Øu ti√™n cao</option>
                <option value="medium">∆Øu ti√™n trung b√¨nh</option>
                <option value="low">∆Øu ti√™n th·∫•p</option>
              </select>
            </div>

            <div class="selected-day-tasks" id="selected-day-tasks"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

  <script>
    // ===== Firebase init =====
    const firebaseConfig = {
      apiKey: "AIzaSyDyAcU3c0aIa4VhGxNFeaWZUX3EcRfus9U",
      authDomain: "zslowccuong.firebaseapp.com",
      databaseURL: "https://zslowccuong-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "zslowccuong",
      storageBucket: "zslowccuong.firebasestorage.app",
      messagingSenderId: "581340060031",
      appId: "1:581340060031:web:4c78ab55e9aabbd07da24a",
      measurementId: "G-XD658JHWN5"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const USER_ID = "default_user";

    const tasksRef    = db.ref("planner/" + USER_ID + "/tasks");
    const frequentRef = db.ref("planner/" + USER_ID + "/frequent");
    const subjectsRef = db.ref("planner/" + USER_ID + "/subjects");

    // ===== ·ª®NG D·ª§NG CH√çNH =====
    const tasks = [];
    const frequentItems = [];

    const STORAGE_KEY = "smart_planner_tasks_v1";
    const STORAGE_FREQUENT_KEY = "smart_planner_frequent_v1";
    const STORAGE_SUBJECTS_KEY = "smart_planner_subjects_v1";

    let subjectStore = {};

    const taskTitleEl = document.getElementById("task-title");
    const taskNoteEl = document.getElementById("task-note");
    const taskLevelEl = document.getElementById("task-level");
    const taskDateEl = document.getElementById("task-date");
    const taskTimeEl = document.getElementById("task-time");
    const taskEndTimeEl = document.getElementById("task-end-time");
    const taskPriorityEl = document.getElementById("task-priority");
    const taskListEl = document.getElementById("task-list");
    const addTaskBtn = document.getElementById("add-task-btn");
    const generateScheduleBtn = document.getElementById("generate-schedule-btn");
    const scheduleTableEl = document.getElementById("schedule-table");
    const tipsBoxEl = document.getElementById("tips-box");
    const tipsListEl = document.getElementById("tips-list");
    const dayDateWrapper = document.getElementById("day-date-wrapper");
    const dayTimeWrapper = document.getElementById("day-time-wrapper");
    const dayEndTimeWrapper = document.getElementById("day-end-time-wrapper");
    const exportPdfBtn = document.getElementById("export-pdf-btn");
    const exportExcelBtn = document.getElementById("export-excel-btn");

    const frequentInputEl = document.getElementById("frequent-input");
    const addFrequentBtn = document.getElementById("add-frequent-btn");
    const frequentListEl = document.getElementById("frequent-list");

    const subjectSelectEl = document.getElementById("subject-select");
    const lessonSearchEl = document.getElementById("lesson-search");
    const lessonTitleEl = document.getElementById("lesson-title");
    const lessonChapterEl = document.getElementById("lesson-chapter");
    const lessonLinkEl = document.getElementById("lesson-link");
    const lessonFileEl = document.getElementById("lesson-file");
    const addLessonBtn = document.getElementById("add-lesson-btn");
    const lessonListEl = document.getElementById("lesson-list");

    const calPrevBtn = document.getElementById("cal-prev");
    const calNextBtn = document.getElementById("cal-next");
    const calendarMonthLabelEl = document.getElementById("calendar-month-label");
    const calendarGridEl = document.getElementById("calendar-grid");

    const selectedDayTitleEl = document.getElementById("selected-day-title");
    const selectedDayTasksEl = document.getElementById("selected-day-tasks");
    const filterLevelEl = document.getElementById("filter-level");
    const filterPriorityEl = document.getElementById("filter-priority");

    const THEME_KEY = "smart_planner_theme_v1";
    let currentTheme = "space";
    const heroBgEl = document.querySelector(".hero-bg");
    const heroSubtitleEl = document.querySelector(".hero-subtitle");
    const heroPillEl = document.querySelector(".hero-pill");
    const toggleThemeBtn = document.getElementById("toggle-theme-btn");

    let selectedDateStr = "";
    let currentMonth;
    let currentYear;

    // ===== Local + Firebase save =====
    function saveTasks() {
      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(tasks));
      } catch (e) {
        console.error("Kh√¥ng th·ªÉ l∆∞u LocalStorage:", e);
      }
      try {
        tasksRef.set(tasks);
      } catch (e) {
        console.error("Kh√¥ng th·ªÉ l∆∞u Firebase tasks:", e);
      }
    }

    function saveFrequent() {
      try {
        const names = frequentItems.map(item => item.name);
        localStorage.setItem(STORAGE_FREQUENT_KEY, JSON.stringify(names));
      } catch (e) {
        console.error("Kh√¥ng th·ªÉ l∆∞u ƒë·ªÅ m·ª•c th∆∞·ªùng d√πng:", e);
      }

      try {
        const names = frequentItems.map(item => item.name);
        frequentRef.set(names);
      } catch (e) {
        console.error("Kh√¥ng th·ªÉ l∆∞u Firebase frequent:", e);
      }
    }

    function saveSubjects() {
      try {
        localStorage.setItem(STORAGE_SUBJECTS_KEY, JSON.stringify(subjectStore));
      } catch (e) {
        console.error("Kh√¥ng th·ªÉ l∆∞u th∆∞ vi·ªán m√¥n h·ªçc:", e);
      }

      try {
        subjectsRef.set(subjectStore);
      } catch (e) {
        console.error("Kh√¥ng th·ªÉ l∆∞u Firebase subjects:", e);
      }
    }

    // ===== Load (local tr∆∞·ªõc, r·ªìi Firebase ghi ƒë√®) =====
    function loadTasks() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (raw) {
          const parsed = JSON.parse(raw);
          if (Array.isArray(parsed)) {
            parsed.forEach(t => {
              tasks.push({
                id: t.id || Date.now() + Math.random(),
                title: t.title || "",
                note: t.note || "",
                level: t.level || "day",
                date: t.date || "",
                time: t.time || "",
                endTime: t.endTime || "",
                completed: !!t.completed,
                priority: t.priority || "medium"
              });
            });
          }
        }
      } catch (e) {
        console.error("Kh√¥ng th·ªÉ ƒë·ªçc LocalStorage:", e);
      }

      tasksRef.once("value")
        .then(snapshot => {
          const data = snapshot.val();
          if (!data || !Array.isArray(data)) {
            renderTasks();
            return;
          }

          tasks.length = 0;
          data.forEach(t => {
            if (!t) return;
            tasks.push({
              id: t.id || Date.now() + Math.random(),
              title: t.title || "",
              note: t.note || "",
              level: t.level || "day",
              date: t.date || "",
              time: t.time || "",
              endTime: t.endTime || "",
              completed: !!t.completed,
              priority: t.priority || "medium"
            });
          });

          renderTasks();
          saveTasks();
        })
        .catch(err => {
          console.error("Kh√¥ng th·ªÉ load Firebase tasks:", err);
          renderTasks();
        });
    }

    function loadFrequent() {
      try {
        const raw = localStorage.getItem(STORAGE_FREQUENT_KEY);
        if (raw) {
          const parsed = JSON.parse(raw);
          if (Array.isArray(parsed)) {
            parsed.forEach((name, idx) => {
              frequentItems.push({ id: Date.now() + idx, name: String(name) });
            });
          }
        }
      } catch (e) {
        console.error("Kh√¥ng th·ªÉ ƒë·ªçc ƒë·ªÅ m·ª•c th∆∞·ªùng d√πng:", e);
      }

      frequentRef.once("value")
        .then(snapshot => {
          const data = snapshot.val();
          if (!data || !Array.isArray(data)) {
            renderFrequent();
            return;
          }

          frequentItems.length = 0;
          data.forEach((name, idx) => {
            if (!name) return;
            frequentItems.push({ id: Date.now() + idx, name: String(name) });
          });

          renderFrequent();
          saveFrequent();
          syncSubjectsWithFrequent();
        })
        .catch(err => {
          console.error("Kh√¥ng th·ªÉ load Firebase frequent:", err);
          renderFrequent();
        });
    }

    function loadSubjects() {
      try {
        const raw = localStorage.getItem(STORAGE_SUBJECTS_KEY);
        if (raw) {
          const parsed = JSON.parse(raw);
          if (parsed && typeof parsed === "object") {
            subjectStore = {};
            Object.keys(parsed).forEach(name => {
              const value = parsed[name];
              if (!value || typeof value !== "object") return;
              const lessons = Array.isArray(value.lessons) ? value.lessons : [];
              subjectStore[name] = {
                lessons: lessons.map(lesson => ({
                  id: lesson.id || Date.now() + Math.random(),
                  title: lesson.title || "",
                  chapter: lesson.chapter || "",
                  link: lesson.link || "",
                  attachments: Array.isArray(lesson.attachments) ? lesson.attachments : []
                }))
              };
            });
          } else {
            subjectStore = {};
          }
        }
      } catch (e) {
        console.error("Kh√¥ng th·ªÉ ƒë·ªçc th∆∞ vi·ªán m√¥n h·ªçc:", e);
        subjectStore = {};
      }

      subjectsRef.once("value")
        .then(snapshot => {
          const data = snapshot.val();
          if (!data || typeof data !== "object") {
            renderSubjectSelect();
            return;
          }

          subjectStore = {};
          Object.keys(data).forEach(name => {
            const value = data[name];
            if (!value || typeof value !== "object") return;
            const lessons = Array.isArray(value.lessons) ? value.lessons : [];
            subjectStore[name] = {
              lessons: lessons.map(lesson => ({
                id: lesson.id || Date.now() + Math.random(),
                title: lesson.title || "",
                chapter: lesson.chapter || "",
                link: lesson.link || "",
                attachments: Array.isArray(lesson.attachments) ? lesson.attachments : []
              }))
            };
          });

          saveSubjects();
          renderSubjectSelect();
        })
        .catch(err => {
          console.error("Kh√¥ng th·ªÉ load Firebase subjects:", err);
          renderSubjectSelect();
        });
    }

    // ===== Theme =====
    function applyTheme(theme) {
      currentTheme = theme === "ctump" ? "ctump" : "space";
      document.body.classList.remove("theme-ctump");

      if (currentTheme === "ctump") {
        document.body.classList.add("theme-ctump");
        heroBgEl.src = "ctump-bg.jpg";
        heroPillEl.textContent = "üè´ Planner CTUMP ¬∑ L·ªãch h·ªçc & √¥n thi";
        heroSubtitleEl.textContent =
          "T·∫≠p trung v√†o l·ªãch h·ªçc, l·ªãch thi v√† k·∫ø ho·∫°ch √¥n t·∫≠p theo tu·∫ßn/th√°ng t·∫°i CTUMP, g·∫Øn v·ªõi th·ªùi kh√≥a bi·ªÉu tr∆∞·ªùng.";
        toggleThemeBtn.textContent = "Giao di·ªán: CTUMP";
      } else {
        heroBgEl.src = "space-bg.jpg";
        heroPillEl.textContent = "üöÄ Planner kh√¥ng gian ¬∑ Qu·∫£n l√Ω th·ªùi gian nh∆∞ phi h√†nh gia";
        heroSubtitleEl.textContent =
          "L·∫≠p k·∫ø ho·∫°ch ng√†y / tu·∫ßn / th√°ng / nƒÉm, l∆∞u t·ª± ƒë·ªông, g·ª£i √Ω khung gi·ªù, v√† ch·ªâ m·ªôt c√∫ click ƒë·ªÉ ch√®n m√¥n h·ªçc hay ƒë·ªÅ m·ª•c l·∫∑p l·∫°i.";
        toggleThemeBtn.textContent = "Giao di·ªán: Space";
      }
    }

    function saveTheme(theme) {
      try {
        localStorage.setItem(THEME_KEY, theme);
      } catch (e) {
        console.error("Kh√¥ng th·ªÉ l∆∞u theme:", e);
      }
    }

    function initTheme() {
      let saved = "space";
      try {
        const raw = localStorage.getItem(THEME_KEY);
        if (raw === "ctump" || raw === "space") saved = raw;
      } catch {}
      applyTheme(saved);
    }

    if (toggleThemeBtn) {
      toggleThemeBtn.addEventListener("click", () => {
        const next = currentTheme === "space" ? "ctump" : "space";
        applyTheme(next);
        saveTheme(next);
      });
    }

    // ===== Logic nh·∫≠p k·∫ø ho·∫°ch =====
    taskLevelEl.addEventListener("change", () => {
      const level = taskLevelEl.value;
      if (level === "day") {
        dayDateWrapper.style.opacity = "1";
        dayDateWrapper.style.pointerEvents = "auto";
        dayTimeWrapper.style.opacity = "1";
        dayTimeWrapper.style.pointerEvents = "auto";
        dayEndTimeWrapper.style.opacity = "1";
        dayEndTimeWrapper.style.pointerEvents = "auto";
      } else {
        dayDateWrapper.style.opacity = "1";
        dayDateWrapper.style.pointerEvents = "auto";
        dayTimeWrapper.style.opacity = "0.4";
        dayTimeWrapper.style.pointerEvents = "none";
        dayEndTimeWrapper.style.opacity = "0.4";
        dayEndTimeWrapper.style.pointerEvents = "none";
        taskTimeEl.value = "";
        taskEndTimeEl.value = "";
      }
    });

    addTaskBtn.addEventListener("click", () => {
      const title = taskTitleEl.value.trim();
      const note = taskNoteEl.value.trim();
      const level = taskLevelEl.value;
      const date = taskDateEl.value || "";
      const time = level === "day" ? (taskTimeEl.value || "") : "";
      const endTime = level === "day" ? (taskEndTimeEl.value || "") : "";
      const priority = taskPriorityEl.value || "medium";

      if (!title) {
        alert("Vui l√≤ng nh·∫≠p ti√™u ƒë·ªÅ k·∫ø ho·∫°ch.");
        return;
      }

      const newTask = {
        id: Date.now(),
        title,
        note,
        level,
        date,
        time,
        endTime,
        completed: false,
        priority
      };

      tasks.push(newTask);
      renderTasks();
      saveTasks();
      clearForm();

      if (selectedDateStr && date === selectedDateStr) {
        showTasksForDate(selectedDateStr);
      }
    });

    function clearForm() {
      taskTitleEl.value = "";
      taskNoteEl.value = "";
    }

    function getLevelBadge(level) {
      switch (level) {
        case "day":
          return '<span class="badge badge-day">Ng√†y</span>';
        case "week":
          return '<span class="badge badge-week">Tu·∫ßn</span>';
        case "month":
          return '<span class="badge badge-month">Th√°ng</span>';
        case "year":
          return '<span class="badge badge-year">NƒÉm</span>';
        default:
          return "";
      }
    }

    function getPriorityBadge(priority) {
      switch (priority) {
        case "high":
          return '<span class="badge badge-priority-high">∆Øu ti√™n cao</span>';
        case "low":
          return '<span class="badge badge-priority-low">∆Øu ti√™n th·∫•p</span>';
        default:
          return '<span class="badge badge-priority-medium">∆Øu ti√™n TB</span>';
      }
    }

    function humanPriorityText(priority) {
      switch (priority) {
        case "high":
          return "Cao";
        case "low":
          return "Th·∫•p";
        default:
          return "Trung b√¨nh";
      }
    }

    function formatTimeRange(task) {
      if (task.time && task.endTime) return `${task.time}‚Äì${task.endTime}`;
      if (task.time) return task.time;
      if (task.endTime) return `ƒê·∫øn: ${task.endTime}`;
      return "";
    }

    function suggestTimeBlock(task) {
      if (task.time || task.endTime) return "";
      switch (task.priority) {
        case "high":
          return "G·ª£i √Ω: l√†m bu·ªïi s√°ng (05:00‚Äì09:00) khi tr√≠ n√£o t·ªânh t√°o nh·∫•t.";
        case "low":
          return "G·ª£i √Ω: l√†m bu·ªïi t·ªëi (19:00‚Äì21:00) cho vi·ªác nh·∫π nh√†ng / mang t√≠nh th√≥i quen.";
        default:
          return "G·ª£i √Ω: l√†m bu·ªïi chi·ªÅu (13:30‚Äì16:30) khi c·∫ßn trao ƒë·ªïi ho·∫∑c x·ª≠ l√Ω vi·ªác m·ª©c v·ª´a.";
      }
    }

    function renderTasks() {
      if (tasks.length === 0) {
        taskListEl.innerHTML =
          '<p style="font-size:13px; color:#6b7280;">Ch∆∞a c√≥ k·∫ø ho·∫°ch n√†o. H√£y th√™m v√†i vi·ªác c·∫ßn l√†m nh√©!</p>';
        return;
      }

      const sorted = [...tasks].sort((a, b) => {
        const levelOrder = { day: 1, week: 2, month: 3, year: 4 };
        if (levelOrder[a.level] !== levelOrder[b.level]) {
          return levelOrder[a.level] - levelOrder[b.level];
        }
        if (a.date && b.date) {
          return a.date.localeCompare(b.date);
        }
        if (a.date && !b.date) return -1;
        if (!a.date && b.date) return 1;
        return a.id - b.id;
      });

      taskListEl.innerHTML = "";
      sorted.forEach(task => {
        const item = document.createElement("div");
        item.className = "task-item";
        if (task.completed && task.level === "day") {
          item.classList.add("completed");
        }

        const main = document.createElement("div");
        main.className = "task-main";

        if (task.level === "day") {
          const checkbox = document.createElement("input");
          checkbox.type = "checkbox";
          checkbox.className = "task-checkbox";
          checkbox.checked = task.completed;

          checkbox.addEventListener("change", () => {
            task.completed = checkbox.checked;
            renderTasks();
            saveTasks();
            if (selectedDateStr && task.date === selectedDateStr) {
              showTasksForDate(selectedDateStr);
            }
          });

          main.appendChild(checkbox);
        }

        const info = document.createElement("div");
        const titleEl = document.createElement("div");
        titleEl.className = "task-title";
        titleEl.innerHTML = getLevelBadge(task.level) + getPriorityBadge(task.priority) + " " + task.title;

        const metaEl = document.createElement("div");
        metaEl.className = "task-meta";

        const parts = [];
        if (task.date) parts.push("Ng√†y: " + formatDateVN(task.date));
        const timeRange = formatTimeRange(task);
        if (task.level === "day" && timeRange) parts.push("Gi·ªù: " + timeRange);
        if (parts.length === 0) parts.push("Kh√¥ng c√≥ ng√†y c·ª• th·ªÉ");
        metaEl.textContent = parts.join(" ¬∑ ");

        info.appendChild(titleEl);
        info.appendChild(metaEl);

        if (task.note) {
          const noteEl = document.createElement("div");
          noteEl.className = "task-note";
          noteEl.textContent = task.note;
          info.appendChild(noteEl);
        }

        if (task.level === "day") {
          const suggest = suggestTimeBlock(task);
          if (suggest) {
            const sugEl = document.createElement("div");
            sugEl.className = "task-suggestion";
            sugEl.textContent = suggest;
            info.appendChild(sugEl);
          }
        }

        main.appendChild(info);

        const actions = document.createElement("div");
        actions.className = "task-actions";

        const deleteBtn = document.createElement("button");
        deleteBtn.className = "small-btn";
        deleteBtn.textContent = "Xo√°";
        deleteBtn.addEventListener("click", () => {
          const index = tasks.findIndex(t => t.id === task.id);
          if (index !== -1) {
            tasks.splice(index, 1);
            renderTasks();
            saveTasks();
            if (selectedDateStr && task.date === selectedDateStr) {
              showTasksForDate(selectedDateStr);
            }
          }
        });

        actions.appendChild(deleteBtn);

        item.appendChild(main);
        item.appendChild(actions);

        taskListEl.appendChild(item);
      });
    }

    function formatDateVN(dateStr) {
      if (!dateStr) return "";
      const [y, m, d] = dateStr.split("-");
      return `${d}/${m}/${y}`;
    }

    function dayOfWeekVN(dateStr) {
      if (!dateStr) return "";
      const [y, m, d] = dateStr.split("-");
      const dt = new Date(Number(y), Number(m) - 1, Number(d));
      const idx = dt.getDay();
      const map = ["Ch·ªß nh·∫≠t", "Th·ª© 2", "Th·ª© 3", "Th·ª© 4", "Th·ª© 5", "Th·ª© 6", "Th·ª© 7"];
      return map[idx] || "";
    }

    // ===== ƒê·ªÅ m·ª•c th∆∞·ªùng d√πng =====
    addFrequentBtn.addEventListener("click", () => {
      const name = frequentInputEl.value.trim();
      if (!name) return;
      const exists = frequentItems.some(item => item.name.toLowerCase() === name.toLowerCase());
      if (exists) {
        alert("ƒê·ªÅ m·ª•c n√†y ƒë√£ c√≥ trong danh s√°ch.");
        return;
      }
      frequentItems.push({ id: Date.now(), name });
      frequentInputEl.value = "";
      renderFrequent();
      saveFrequent();
      syncSubjectsWithFrequent();
    });

    function renderFrequent() {
      if (frequentItems.length === 0) {
        frequentListEl.innerHTML =
          '<span style="font-size:12px; color:#6b7280;">Ch∆∞a c√≥ ƒë·ªÅ m·ª•c n√†o. H√£y th√™m v√†i m√¥n h·ªçc / ho·∫°t ƒë·ªông.</span>';
        return;
      }
      frequentListEl.innerHTML = "";
      frequentItems.forEach(item => {
        const chip = document.createElement("div");
        chip.className = "chip";
        chip.title = "B·∫•m ƒë·ªÉ ch√®n v√†o ti√™u ƒë·ªÅ k·∫ø ho·∫°ch";

        const label = document.createElement("span");
        label.textContent = item.name;

        chip.addEventListener("click", () => {
          if (!taskTitleEl.value) {
            taskTitleEl.value = item.name;
          } else {
            taskTitleEl.value = taskTitleEl.value + " ¬∑ " + item.name;
          }
          taskTitleEl.focus();
        });

        const remove = document.createElement("span");
        remove.className = "chip-remove";
        remove.textContent = "√ó";
        remove.title = "X√≥a ƒë·ªÅ m·ª•c n√†y";
        remove.addEventListener("click", (e) => {
          e.stopPropagation();
          const index = frequentItems.findIndex(f => f.id === item.id);
          if (index !== -1) {
            frequentItems.splice(index, 1);
            renderFrequent();
            saveFrequent();
            renderSubjectSelect();
          }
        });

        chip.appendChild(label);
        chip.appendChild(remove);
        frequentListEl.appendChild(chip);
      });
    }

    // ===== Th∆∞ vi·ªán m√¥n h·ªçc =====
    function syncSubjectsWithFrequent() {
      frequentItems.forEach(item => {
        if (!subjectStore[item.name]) {
          subjectStore[item.name] = { lessons: [] };
        }
      });
      saveSubjects();
      renderSubjectSelect();
    }

    function renderSubjectSelect() {
      subjectSelectEl.innerHTML = "";
      if (frequentItems.length === 0) {
        subjectSelectEl.disabled = true;
        const opt = document.createElement("option");
        opt.value = "";
        opt.textContent = 'Ch∆∞a c√≥ m√¥n h·ªçc (th√™m ·ªü "ƒê·ªÅ m·ª•c th∆∞·ªùng d√πng")';
        subjectSelectEl.appendChild(opt);
        lessonListEl.innerHTML =
          '<p style="font-size:12px; color:#6b7280;">Ch∆∞a c√≥ m√¥n h·ªçc ƒë·ªÉ hi·ªÉn th·ªã.</p>';
        return;
      }
      subjectSelectEl.disabled = false;

      frequentItems.forEach(item => {
        const opt = document.createElement("option");
        opt.value = item.name;
        opt.textContent = item.name;
        subjectSelectEl.appendChild(opt);
      });

      if (!subjectSelectEl.value && frequentItems[0]) {
        subjectSelectEl.value = frequentItems[0].name;
      }
      renderLessonsForSelectedSubject();
    }

    subjectSelectEl.addEventListener("change", renderLessonsForSelectedSubject);
    lessonSearchEl.addEventListener("input", renderLessonsForSelectedSubject);

    function renderLessonsForSelectedSubject() {
      const subjectName = subjectSelectEl.value;
      if (!subjectName) {
        lessonListEl.innerHTML =
          '<p style="font-size:12px; color:#6b7280;">Ch∆∞a ch·ªçn m√¥n h·ªçc.</p>';
        return;
      }

      const subject = subjectStore[subjectName] || { lessons: [] };
      subjectStore[subjectName] = subject;
      const lessons = subject.lessons || [];

      const keyword = (lessonSearchEl.value || "").trim().toLowerCase();
      let filtered = lessons;
      if (keyword) {
        filtered = lessons.filter(lesson =>
          (lesson.title && lesson.title.toLowerCase().includes(keyword)) ||
          (lesson.chapter && lesson.chapter.toLowerCase().includes(keyword)) ||
          (lesson.link && lesson.link.toLowerCase().includes(keyword))
        );
      }

      if (filtered.length === 0) {
        const msg = lessons.length === 0
          ? "Ch∆∞a c√≥ b√†i h·ªçc n√†o cho m√¥n n√†y."
          : "Kh√¥ng t√¨m th·∫•y b√†i h·ªçc n√†o kh·ªõp v·ªõi t·ª´ kh√≥a.";
        lessonListEl.innerHTML =
          `<p style="font-size:12px; color:#6b7280;">${msg}</p>`;
        return;
      }

      lessonListEl.innerHTML = "";
      filtered.forEach(lesson => {
        const div = document.createElement("div");
        div.className = "lesson-item";

        const title = document.createElement("div");
        title.className = "lesson-title";
        title.textContent = lesson.title || "(Kh√¥ng t√™n b√†i h·ªçc)";

        const meta = document.createElement("div");
        meta.className = "lesson-meta";
        const parts = [];
        if (lesson.chapter) parts.push("Ch∆∞∆°ng/ch·ªß ƒë·ªÅ: " + lesson.chapter);
        meta.textContent = parts.join(" ¬∑ ");

        div.appendChild(title);
        if (parts.length > 0) div.appendChild(meta);

        if (lesson.link) {
          const linkDiv = document.createElement("div");
          linkDiv.className = "lesson-links";
          linkDiv.textContent = "Link / ghi ch√∫: " + lesson.link;
          div.appendChild(linkDiv);
        }

        if (Array.isArray(lesson.attachments) && lesson.attachments.length > 0) {
          const filesDiv = document.createElement("div");
          filesDiv.className = "lesson-files";
          filesDiv.textContent = "File ƒë√≠nh k√®m: ";

          lesson.attachments.forEach(att => {
            const a = document.createElement("a");
            a.className = "lesson-file-link";
            a.href = att.dataUrl;
            a.download = att.name || "file";
            a.target = "_blank";
            a.rel = "noopener noreferrer";
            a.textContent = att.name || "file";

            filesDiv.appendChild(a);

            if (att.type && att.type.startsWith("image/")) {
              const img = document.createElement("img");
              img.src = att.dataUrl;
              img.alt = att.name || "·∫¢nh";
              img.className = "lesson-thumb";
              filesDiv.appendChild(img);
            }
          });

          div.appendChild(filesDiv);
        }

        const actions = document.createElement("div");
        const delBtn = document.createElement("button");
        delBtn.className = "small-btn";
        delBtn.textContent = "Xo√° b√†i h·ªçc";
        delBtn.addEventListener("click", () => {
          const sub = subjectStore[subjectName];
          if (!sub) return;
          const idx = sub.lessons.findIndex(l => l.id === lesson.id);
          if (idx !== -1) {
            sub.lessons.splice(idx, 1);
            saveSubjects();
            renderLessonsForSelectedSubject();
          }
        });
        actions.appendChild(delBtn);
        div.appendChild(actions);

        lessonListEl.appendChild(div);
      });
    }

    addLessonBtn.addEventListener("click", () => {
      const subjectName = subjectSelectEl.value;
      if (!subjectName) {
        alert('Ch∆∞a c√≥ m√¥n h·ªçc. Th√™m m√¥n ·ªü "ƒê·ªÅ m·ª•c th∆∞·ªùng d√πng" tr∆∞·ªõc.');
        return;
      }

      const title = lessonTitleEl.value.trim();
      const chapter = lessonChapterEl.value.trim();
      const link = lessonLinkEl.value.trim();

      if (!title) {
        alert("Vui l√≤ng nh·∫≠p t√™n b√†i h·ªçc.");
        return;
      }

      const files = Array.from(lessonFileEl.files || []);
      const attachments = [];

      const finalizeSave = () => {
        if (!subjectStore[subjectName]) {
          subjectStore[subjectName] = { lessons: [] };
        }
        const lessons = subjectStore[subjectName].lessons;
        lessons.push({
          id: Date.now() + Math.random(),
          title,
          chapter,
          link,
          attachments
        });
        saveSubjects();
        renderLessonsForSelectedSubject();

        lessonTitleEl.value = "";
        lessonChapterEl.value = "";
        lessonLinkEl.value = "";
        lessonFileEl.value = "";
      };

      if (files.length === 0) {
        finalizeSave();
        return;
      }

      let remaining = files.length;
      files.forEach(file => {
        const reader = new FileReader();
        reader.onload = (e) => {
          attachments.push({
            id: Date.now() + Math.random(),
            name: file.name,
            type: file.type,
            dataUrl: e.target.result
          });
          remaining--;
          if (remaining === 0) finalizeSave();
        };
        reader.onerror = () => {
          console.error("L·ªói khi ƒë·ªçc file:", file.name);
          remaining--;
          if (remaining === 0) finalizeSave();
        };
        reader.readAsDataURL(file);
      });
    });

    // ===== Th·ªùi kh√≥a bi·ªÉu tu·∫ßn =====
    generateScheduleBtn.addEventListener("click", generateSmartWeekSchedule);

    function generateSmartWeekSchedule() {
      const weeklyTasks = tasks.filter(t => t.level === "week");

      if (weeklyTasks.length === 0) {
        scheduleTableEl.innerHTML =
          '<tr><td style="padding:10px; font-size:13px; color:#6b7280;">Ch∆∞a c√≥ "k·∫ø ho·∫°ch trong tu·∫ßn" n√†o ƒë·ªÉ ph√¢n ph·ªëi.</td></tr>';
        tipsBoxEl.style.display = "none";
        return;
      }

      const days = ["Th·ª© 2", "Th·ª© 3", "Th·ª© 4", "Th·ª© 5", "Th·ª© 6", "Th·ª© 7", "Ch·ªß nh·∫≠t"];
      const schedule = days.map(() => []);

      weeklyTasks.forEach(task => {
        let minIndex = 0;
        for (let i = 1; i < schedule.length; i++) {
          if (schedule[i].length < schedule[minIndex].length) {
            minIndex = i;
          }
        }
        schedule[minIndex].push(task);
      });

      let html = "<thead><tr><th>Ng√†y</th>";
      days.forEach(day => {
        html += `<th>${day}</th>`;
      });
      html += "</tr></thead><tbody>";

      html += "<tr><th>C√¥ng vi·ªác</th>";
      schedule.forEach(dayTasks => {
        html += "<td>";
        if (dayTasks.length === 0) {
          html += '<span style="font-size:11px; color:#6b7280;">(Tr·ªëng)</span>';
        } else {
          dayTasks.forEach(task => {
            const blockShort =
              task.priority === "high"
                ? "S√°ng"
                : task.priority === "low"
                ? "T·ªëi"
                : "Chi·ªÅu";

            html += `
              <div class="schedule-task">
                <span class="schedule-task-title">${task.title}</span>
                ${task.note ? `<span class="schedule-task-note">${task.note}</span>` : ""}
                <span class="schedule-task-extra">
                  ∆Øu ti√™n: ${humanPriorityText(task.priority)} ¬∑ G·ª£i √Ω khung gi·ªù: ${blockShort}
                </span>
              </div>
            `;
          });
        }
        html += "</td>";
      });
      html += "</tr></tbody>";

      scheduleTableEl.innerHTML = html;
      generateTimeManagementTips(schedule, days);
    }

    function generateTimeManagementTips(schedule, days) {
      const counts = schedule.map(dayTasks => dayTasks.length);
      const maxTasks = Math.max(...counts);
      const minTasks = Math.min(...counts);
      const tips = [];

      const overloadedDays = [];
      counts.forEach((count, index) => {
        if (count === maxTasks && count > 2) {
          overloadedDays.push(days[index]);
        }
      });
      if (overloadedDays.length > 0) {
        tips.push(
          `üî¥ ${overloadedDays.join(", ")} kh√° nhi·ªÅu vi·ªác. H√£y ch·ªçn 1‚Äì2 vi·ªác quan tr·ªçng nh·∫•t (MIT), ph·∫ßn c√≤n l·∫°i d·ªùi sang ng√†y kh√°c.`
        );
      }

      const lightDays = [];
      counts.forEach((count, index) => {
        if (count === minTasks && count === 0) {
          lightDays.push(days[index]);
        }
      });
      if (lightDays.length > 0) {
        tips.push(
          `üü¢ ${lightDays.join(", ")} ƒëang tr·ªëng. D√πng ƒë·ªÉ l√†m vi·ªác s√¢u (deep work) ho·∫∑c ngh·ªâ ng∆°i ph·ª•c h·ªìi.`
        );
      }

      if (maxTasks - minTasks >= 3) {
        tips.push(
          "‚öñÔ∏è Kh·ªëi l∆∞·ª£ng c√¥ng vi·ªác gi·ªØa c√°c ng√†y h∆°i l·ªách. Th·ª≠ chuy·ªÉn b·ªõt vi·ªác t·ª´ ng√†y b·∫≠n sang ng√†y r·∫£nh ƒë·ªÉ ƒë·ªÅu h∆°n."
        );
      }

      tips.push(
        "‚è±Ô∏è M·ªói bu·ªïi ch·ªâ n√™n c√≥ 1‚Äì3 vi·ªác quan tr·ªçng. C√≤n l·∫°i d√†nh cho vi·ªác nh·ªè, email, nh·∫Øn tin v√† ngh·ªâ ng·∫Øn."
      );

      tipsListEl.innerHTML = "";
      tips.forEach(tip => {
        const li = document.createElement("li");
        li.textContent = tip;
        tipsListEl.appendChild(li);
      });

      tipsBoxEl.style.display = "block";
    }

    // ===== Xu·∫•t PDF & Excel =====
    exportPdfBtn.addEventListener("click", () => {
      if (!scheduleTableEl.innerHTML.trim()) {
        alert("Vui l√≤ng t·∫°o th·ªùi kh√≥a bi·ªÉu tu·∫ßn tr∆∞·ªõc khi xu·∫•t PDF.");
        return;
      }
      const printWindow = window.open("", "_blank");
      if (!printWindow) {
        alert("Tr√¨nh duy·ªát ch·∫∑n c·ª≠a s·ªï m·ªõi. H√£y cho ph√©p popup.");
        return;
      }
      printWindow.document.write(`
        <html>
          <head>
            <title>Th·ªùi kh√≥a bi·ªÉu tu·∫ßn</title>
            <meta charset="UTF-8" />
            <style>
              body { font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; padding: 16px; }
              h3 { margin-bottom: 12px; }
              table { border-collapse: collapse; width: 100%; font-size: 12px; }
              th, td { border: 1px solid #999; padding: 6px; vertical-align: top; }
              th { background: #eee; }
              .schedule-task { border-radius: 8px; padding: 4px 6px; margin-bottom: 4px; border: 1px solid #ddd; }
              .schedule-task-title { font-weight: 600; }
              .schedule-task-note { font-size: 11px; }
              .schedule-task-extra { font-size: 11px; font-style: italic; }
            </style>
          </head>
          <body>
            <h3>Th·ªùi kh√≥a bi·ªÉu tu·∫ßn</h3>
            ${scheduleTableEl.outerHTML}
          </body>
        </html>
      `);
      printWindow.document.close();
      printWindow.focus();
      printWindow.print();
    });

    exportExcelBtn.addEventListener("click", () => {
      if (!scheduleTableEl.innerHTML.trim()) {
        alert("Vui l√≤ng t·∫°o th·ªùi kh√≥a bi·ªÉu tu·∫ßn tr∆∞·ªõc khi xu·∫•t Excel.");
        return;
      }
      const html =
        `<html><head><meta charset="UTF-8" /></head><body><table>` +
        scheduleTableEl.innerHTML +
        `</table></body></html>`;

      const blob = new Blob([html], { type: "application/vnd.ms-excel" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "thoikhoabieu_tuan.xls";
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      setTimeout(() => URL.revokeObjectURL(url), 1000);
    });

    // ===== L·ªãch t∆∞∆°ng t√°c =====
    function initCalendar() {
      const today = new Date();
      currentMonth = today.getMonth();
      currentYear = today.getFullYear();
      renderCalendar(currentMonth, currentYear);
    }

    function getMonthNameVI(monthIndex) {
      const names = [
        "Th√°ng 1", "Th√°ng 2", "Th√°ng 3", "Th√°ng 4",
        "Th√°ng 5", "Th√°ng 6", "Th√°ng 7", "Th√°ng 8",
        "Th√°ng 9", "Th√°ng 10", "Th√°ng 11", "Th√°ng 12"
      ];
      return names[monthIndex] || "";
    }

    function renderCalendar(month, year) {
      calendarMonthLabelEl.textContent = `${getMonthNameVI(month)} / ${year}`;
      calendarGridEl.innerHTML = "";

      const firstDay = new Date(year, month, 1);
      let startDay = firstDay.getDay();
      startDay = (startDay + 6) % 7;

      const daysInMonth = new Date(year, month + 1, 0).getDate();
      const daysInPrevMonth = new Date(year, month, 0).getDate();

      const today = new Date();
      const isCurrentMonth = today.getFullYear() === year && today.getMonth() === month;

      for (let i = 0; i < 42; i++) {
        const cell = document.createElement("div");
        cell.className = "calendar-day";

        let dateNumber;
        let cellMonth = month;
        let cellYear = year;
        let inCurrentMonth = true;

        if (i < startDay) {
          dateNumber = daysInPrevMonth - (startDay - 1 - i);
          inCurrentMonth = false;
          cellMonth = month - 1;
          if (cellMonth < 0) {
            cellMonth = 11;
            cellYear = year - 1;
          }
          cell.classList.add("calendar-day--other-month");
        } else if (i >= startDay + daysInMonth) {
          dateNumber = i - (startDay + daysInMonth) + 1;
          inCurrentMonth = false;
          cellMonth = month + 1;
          if (cellMonth > 11) {
            cellMonth = 0;
            cellYear = year + 1;
          }
          cell.classList.add("calendar-day--other-month");
        } else {
          dateNumber = i - startDay + 1;
        }

        cell.textContent = dateNumber;

        const mm = String(cellMonth + 1).padStart(2, "0");
        const dd = String(dateNumber).padStart(2, "0");
        const dateStr = `${cellYear}-${mm}-${dd}`;
        cell.dataset.date = dateStr;

        if (isCurrentMonth && inCurrentMonth && dateNumber === today.getDate()) {
          cell.classList.add("calendar-day--today");
        }

        if (selectedDateStr && selectedDateStr === dateStr) {
          cell.classList.add("calendar-day--selected");
        }

        cell.addEventListener("click", () => {
          currentMonth = cellMonth;
          currentYear = cellYear;
          selectedDateStr = dateStr;
          renderCalendar(currentMonth, currentYear);
          showTasksForDate(selectedDateStr);
        });

        calendarGridEl.appendChild(cell);
      }
    }

    calPrevBtn.addEventListener("click", () => {
      currentMonth--;
      if (currentMonth < 0) {
        currentMonth = 11;
        currentYear--;
      }
      renderCalendar(currentMonth, currentYear);
    });

    calNextBtn.addEventListener("click", () => {
      currentMonth++;
      if (currentMonth > 11) {
        currentMonth = 0;
        currentYear++;
      }
      renderCalendar(currentMonth, currentYear);
    });

    filterLevelEl.addEventListener("change", () => {
      if (selectedDateStr) showTasksForDate(selectedDateStr);
    });
    filterPriorityEl.addEventListener("change", () => {
      if (selectedDateStr) showTasksForDate(selectedDateStr);
    });

    function showTasksForDate(dateStr) {
      const ds = formatDateVN(dateStr);
      const dow = dayOfWeekVN(dateStr);
      selectedDayTitleEl.innerHTML = `K·∫ø ho·∫°ch c·ªßa <span>${dow}, ng√†y ${ds}</span>:`;

      const levelFilter = filterLevelEl.value;
      const priorityFilter = filterPriorityEl.value;

      let dayTasks = tasks.filter(t => t.date === dateStr);

      if (levelFilter !== "all") {
        dayTasks = dayTasks.filter(t => t.level === levelFilter);
      }
      if (priorityFilter !== "all") {
        dayTasks = dayTasks.filter(t => t.priority === priorityFilter);
      }

      if (dayTasks.length === 0) {
        selectedDayTasksEl.innerHTML =
          '<p style="font-size:12px; color:#6b7280;">Kh√¥ng c√≥ k·∫ø ho·∫°ch n√†o cho ng√†y n√†y (v·ªõi b·ªô l·ªçc hi·ªán t·∫°i).</p>';
        return;
      }

      const sorted = [...dayTasks].sort((a, b) => {
        if (a.time && b.time) return a.time.localeCompare(b.time);
        if (a.time && !b.time) return -1;
        if (!a.time && b.time) return 1;
        return a.id - b.id;
      });

      selectedDayTasksEl.innerHTML = "";
      sorted.forEach(task => {
        const div = document.createElement("div");
        div.className = "selected-day-task";

        const title = document.createElement("div");
        title.className = "selected-day-task-title";
        title.textContent = task.title;

        const meta = document.createElement("div");
        meta.className = "selected-day-task-meta";
        const parts = [];
        const timeRange = formatTimeRange(task);
        if (timeRange) parts.push("Gi·ªù: " + timeRange);
        parts.push("M·ª©c: " + humanPriorityText(task.priority));
        parts.push("Lo·∫°i: " + (
          task.level === "day" ? "Trong ng√†y" :
          task.level === "week" ? "Trong tu·∫ßn" :
          task.level === "month" ? "Trong th√°ng" : "Trong nƒÉm"
        ));
        meta.textContent = parts.join(" ¬∑ ");

        div.appendChild(title);
        div.appendChild(meta);

        if (task.note) {
          const note = document.createElement("div");
          note.className = "selected-day-task-note";
          note.textContent = task.note;
          div.appendChild(note);
        }

        selectedDayTasksEl.appendChild(div);
      });
    }

    // ===== Kh·ªüi t·∫°o =====
    loadTasks();
    loadFrequent();
    loadSubjects();
    renderTasks();
    renderFrequent();
    syncSubjectsWithFrequent();
    taskLevelEl.dispatchEvent(new Event("change"));
    initCalendar();
    initTheme();
  </script>
</body>
</html>
